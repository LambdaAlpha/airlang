# 求值

## 普通调用

`f ; i`：以 `i` 为输入调用 `f`

- 对 `f` 求值，得到 `f1`
- 若 `f1` 是一个函数
  - 根据 `f1` 的调用模式对 `i` 求值，得到 `i1`
  - 以当前上下文和输入 `i1` 调用函数 `f1`，并返回其返回值
- 若 `f1` 是一个符号
  - 从上下文中移除 `f1` 绑定的函数 `f2`
  - 根据 `f2` 的调用模式对 `i` 求值，得到 `i1`
  - 以当前上下文和输入 `i1` 调用函数 `f2`，得到 `o`
  - 将 `f2` 以原绑定方式绑定到 `f1`
  - 返回 `o`
- 否则对 `i` 求值，得到 `i1`，返回 `f1 ; i1`

## 类调用

`~(f) ; i`：基于不变量 `f` 优化 `i`

- 对 `f` 求值，得到 `f1`
- 若 `f1` 是一个函数
  - 根据 `f1` 的类模式对 `i` 求值，得到 `i1`
  - 若上下文存在求解器
    - 若上下文的求解器 `s` 是静态函数，以当前上下文和输入 `~(f1) ; i1` 调用 `s`，得到 `a`
    - 否则，从上下文中移除求解器 `s`，以当前上下文和输入 `~(f1) ; i1` 调用 `s`，得到 `a`，设置上下文的求解器为 `s`
    - 若 `a` 不等于 `i1`，则返回 `a`
    - 否则返回单元或任意 `v`，满足：以 `v` 调用 `f1` 和以 `i1` 调用 `f1` 的输出总是相等
  - 否则返回单元或任意 `v`，满足：以 `v` 调用 `f1` 和以 `i1` 调用 `f1` 的输出总是相等
- 否则对 `i` 求值，得到 `i1`，返回 `~(f1) ; i1`

## 逆调用

`!(f) ; i`：以 `i` 为输出逆向 `f`，并使上下文变成当前上下文的逆向

- 对 `f` 求值，得到 `f1`
- 若 `f1` 是一个函数
  - 根据 `f1` 的逆模式对 `o` 求值，得到 `o1`
  - 若上下文存在求解器
    - 若上下文的求解器 `s` 是静态函数，以当前上下文和输入 `!(f1) ; o1` 调用 `s`，得到 `a`
    - 否则，从上下文中移除求解器 `s`，以当前上下文和输入 `!(f1) ; o1` 调用 `s`，得到 `a`，设置上下文的求解器为 `s`
    - 若 `a` 不是单元，则返回 `a`
    - 否则返回单元或任意 `i`，满足：以 `i` 调用 `f1` 总是输出 `o1`
  - 否则返回单元或任意 `i`，满足：以 `i` 调用 `f1` 总是输出 `o1`
- 否则对 `o` 求值，得到 `o1`，返回 `!(f1) ; o1`
