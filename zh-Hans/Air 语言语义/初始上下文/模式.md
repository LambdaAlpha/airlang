# 模式

## mode

类型：function

上下文访问：无关

调用输入模式：`form.`

构造一个模式函数。

模式函数根据模式对输入进行变换。

模式函数用于提供灵活的解释代码的方式。

所有类型分为四种

- 符号类型：符号
- 形式类型：配对，列表，映射
- 语义类型：任务
- 恒等类型：其他类型

| 模式\类型 |恒等类型|符号类型|形式类型|语义类型|
| -- | -- | -- | -- | -- |
|恒等模式|恒等变换|恒等变换|恒等变换|恒等变换|
|形式模式|恒等变换|符号变换|形式变换|形式变换|
|语义模式|恒等变换|符号变换|形式变换|语义变换|

### 变换

- 符号变换
  - `.a` 表示字面量 `a`
  - `@a` 表示读取上下文中 `a` 的值
  - `#a` 表示移动上下文中 `a` 的值
  - `$a` 表示读取上下文中 `a` 的值并对其求值
  - `a` 根据模式的配置，可以表示以上三种语义中的一种
- 恒等变换：变换为自身，即不变。
- 形式变换：结构性变换，即对其子结构进行变换。
- 语义变换：按其语义变换，见[求值规则](../求值.md)。

### 模式

以下模式可以应用于所有类型。

#### 恒等模式

对所有的类型应用恒等模式。

#### 统一模式

对所有的类型应用统一的模式。

#### 基础模式

对每个类型应用指定的模式，对形式类型和语义类型的子结构递归应用此模式。

#### 组合模式

对每个类型应用指定的模式，对形式类型和语义类型的子结构应用指定的模式。

- 配对：若第一个值为特定值，则对第二个值应用指定模式，否则对第一个值应用一个模式，对第二个值应用另一个模式
- 任务：对函数应用一个模式，对输入应用另一个模式，对上下文应用另一个模式
- 列表：对列表的前一部分元素应用指定的模式，对剩余元素应用另一个模式
- 映射：对映射中的部分键的值应用指定的模式，对剩余键的值应用值的模式

#### 函数模式

函数模式通过函数进行变换。

函数模式提供了执行任意变换的能力。

### 例子

- `eval@`：对任意值应用 `eval@`
- `{}`：非递归，对任意值应用默认模式
- `{pair : {} : form. : eval@}`：非递归，对配对的第一项应用 `form.`，对配对的第二项应用 `eval@`；对其他任何值应用默认模式
- `{symbol : ., primitive : true}`：递归，对符号应用 `.`；对其他类型都应用默认模式，对子项递归应用此模式
- `{task : form, primitive : true}`：递归，对任务的函数，上下文和输入分别应用此模式，然后对任务应用 `form` 模式；对其他任何值应用默认模式
- `{pair : {a : form.} : form@ : {symbol : .}}`：非递归，若第一项为 `a`，则对第二项应用 `form.`，否则对配对的第一项应用 `form@`，对配对的第二项应用 `{symbol : .}`；对其他类型都应用默认模式（`.`）
- `{list : [form#, .] : eval.}` 非递归，对列表的第一项应用 `form#`，对第二项应用 `.`，对剩余其他项应用 `eval.`；对其他任何值应用默认模式（`.`）
- `{map : {a : ., b : eval@} : .}`：非递归，对映射的以 `a` 为键的值应用 `.`，对以 `b` 为键的值应用 `eval@`，对任何其他键的值应用 `.`；对其他任何值应用默认模式（`.`）

## id

类型：function

上下文访问：无关

调用输入模式：`.`

对 i 应用恒等变换，输出其结果。

## form.

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `form.`，输出其结果。

## form@

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `form@`，输出其结果。

## form#

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `form#`，输出其结果。

## form$

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `form$`，输出其结果。

## eval.

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `eval.`，输出其结果。

## eval@

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `eval@`，输出其结果。

## eval#

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `eval#`，输出其结果。

## eval$

类型：function

上下文访问：可变

调用输入模式：`.`

对 i 应用 `eval$`，输出其结果。
