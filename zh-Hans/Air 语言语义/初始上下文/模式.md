# 模式

## mode

类型：function

上下文访问：无关

调用模式：`form.`

构造一个模式函数。

模式函数根据模式对输入进行变换。

模式函数用于提供灵活的解释代码的方式。

### 配对

若第一个值为特定值，则对第二个值应用指定模式，否则对第一个值应用一个模式，对第二个值应用另一个模式

### 列表

对列表的前一部分元素应用指定的模式，对剩余元素应用另一个模式

### 映射

对映射中的部分键的值应用指定的模式，对剩余键的值应用值的模式

### 符号

- 不变模式：不变
- 有前缀符号根据 [求值规则](../求值.md) 中的规则求值
- 无前缀 `a` 表示
  - 字面量模式：字面量 `a`
  - 引用模式：读取上下文中 `a` 的值
  - 求值模式：读取上下文中 `a` 的值并对其求值

### 任务

- 形式模式：对函数应用一个模式，对输入应用另一个模式，对上下文应用另一个模式
- 求值模式：见 [求值规则](../求值.md)

### 组合模式

对每个类型指定其变换方式，对形式类型（配对，任务，列表，映射）还可以指定其子结构的模式，若未指定，则递归应用当前模式。

### 函数模式

函数模式通过函数进行变换。

函数模式提供了执行任意变换的能力。

### 例子

`default` 表示一个基础模式，其指定了符号和任务的变换方式。

|   | 任务 | 符号 |
| - | - | - |
| `form` | 形式 | 不变 |
| `form.` | 形式 | 字面量 |
| `form@` | 形式 | 引用 |
| `form$` | 形式 | 求值 |
| `eval` | 求值 | 不变 |
| `eval.` | 求值 | 字面量 |
| `eval@` | 求值 | 引用 |
| `eval$` | 求值 | 求值 |

若不指定 `default`，或者指定 `default` 为单元，则表示 `form`

- `eval@`：对任意值应用 `eval@`
- `{}`：对任意值不变换
- `{pair : {} : form. : eval@}`：对配对的第一项应用 `form.`，对配对的第二项应用 `eval@`；对其他任何值不变换
- `{default : eval@}`：对符号应用引用模式，对任务应用求值模式，对配对，列表，映射递归应用此模式
- `{default : eval@, pair : {a : form.} : form@ : {default : eval}}`：若第一项为 `a`，则对第二项应用 `form.`，否则对配对的第一项应用 `form@`，对配对的第二项应用 `{default : eval}`；对符号应用引用模式，对任务应用求值模式，对列表，映射递归应用 `eval@` 模式
- `{default : form, list : [form$, .] : eval.}`：对符号应用不变模式，对任务应用形式模式，对列表的第一项应用 `form$`，对第二项应用 `.`，对剩余其他项应用 `eval.`；对配对，映射递归应用 `form` 模式
- `{map : {a : ., b : eval@} : .}`：对符号应用不变模式，对任务应用形式模式，对映射的以 `a` 为键的值应用 `form`，对以 `b` 为键的值应用 `eval@`，对任何其他键的值应用 `form`；对配对，列表递归应用默认模式（`form`）

## form

类型：function

上下文访问：无关

调用模式：`.`

对 i 应用 `form`，输出其结果。

## form.

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `form.`，输出其结果。

## form@

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `form@`，输出其结果。

## form$

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `form$`，输出其结果。

## eval

类型：function

上下文访问：无关

调用模式：`.`

对 i 应用 `eval`，输出其结果。

## eval.

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `eval.`，输出其结果。

## eval@

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `eval@`，输出其结果。

## eval$

类型：function

上下文访问：可变

调用模式：`.`

对 i 应用 `eval$`，输出其结果。
