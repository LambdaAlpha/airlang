# 上下文

## context.read

类型：function

上下文访问：不变

输出符号 i 所绑定的值。

## context.assign

类型：function

上下文访问：可变

适配器 `adapter@context.assign`：`{pair : {} : form. : eval@}`

模式匹配与赋值。仅匹配一个模式，若匹配成功，则执行绑定。

- 符号前缀 `*` 表示符号字面量
- 符号前缀 `#` 表示绑定变量名

### 匹配绑定

匹配绑定 `bind` 与 `value` 的过程：

- 若 `pattern` 为符号 `a`，则匹配任意值 `v`，按照当前默认选项将 `v` 绑定到 `a`，输出 `c`，`c` 为 `a` 当前所绑定的值或单元
- 若 `pattern` 为字面量 `v`，则匹配 `v`
- 若 `pattern` 为 `b1 : b2`（`_ b1 b2)`），则匹配 `v1 : v2`（`_ v1 v2`），递归
  - 将 `v1` 与 `b1` 匹配绑定，得到 `cv1`
  - 将 `v2` 与 `b2` 匹配绑定，得到 `cv2`
  - 将 `v3` 与 `b3` 匹配绑定，得到 `cv3`
  - 输出 `cv1 : cv2`（`_ cv1 cv2`）
- 若 `pattern` 为 `[b1, b2, ..., bn]`，则匹配列表 `l`，递归
  - 将 `l` 的第一个值或单元与 `b1` 匹配绑定，得到 `cv1`
  - 将 `l` 的第二个值或单元与 `b2` 匹配绑定，得到 `cv2`
  - 将 `l` 的第 `n` 个值或单元与 `bn` 匹配绑定，得到 `cvn`
  - 输出 `[cv1, cv2, ., cvn-1, cvn]`
- 若 `pattern` 为 `{k1 : b1, k2 : b2}`，则匹配映射 `m`，递归
  - 将 `m` 中 `k1` 所绑定的值或者单元与 `b1` 匹配绑定，得到 `cv1`
  - 将 `m` 中 `k2` 所绑定的值或者单元与 `b2` 匹配绑定，得到 `cv2`
  - 输出 `{k1 : cv1, k2 : cv2}`

## context.is_constant

类型：function

上下文访问：不变

输出当前上下文是否不变。

## context.self

类型：function

上下文访问：不变

输出当前上下文。

## context.which

类型：function

上下文访问：可变

适配器 `adapter@context.which`：`form`

i 为 `ctx : _ f i`，对 f 求值，得到函数 f1，导入 f1 的适配器，对 i 适配，得到 i1，在 c 中以符号 ctx 为键，得到上下文 c1，以 c1 为上下文，以 i1 为输入调用 f1。
