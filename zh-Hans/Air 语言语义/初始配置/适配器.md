# 适配器

## adapter.new

类型：function

上下文访问：无关

适配器 `adapter@adapter.new`：`form.`

构造一个适配器函数。

适配器函数对输入进行变换。

适配器函数用于提供灵活的解释代码的方式。

### 配对

若第一个值为特定值，则对第二个值应用指定适配器，否则对第一个值应用一个适配器，对第二个值应用另一个适配器

### 列表

对列表的前一部分元素应用指定的适配器，对剩余元素应用另一个适配器

### 映射

对映射中的部分键的值应用指定的适配器，对剩余键的值应用值的适配器

### 符号

- 不变适配器：不变
- 有前缀符号根据 [求值规则](../求值.md) 中的规则求值
- 无前缀 `a` 表示
  - 字面量适配器：字面量 `a`
  - 引用适配器：读取上下文中 `a` 的值
  - 求值适配器：读取上下文中 `a` 的值并对其求值

### 调用

- 形式适配器：对函数应用一个适配器，对输入应用另一个适配器
- 求值适配器：见 [求值规则](../求值.md)

### 组合适配器

对每个类型指定其变换方式，对形式类型（配对，调用，列表，映射）还可以指定其子结构的适配器，若未指定，则递归应用当前适配器。

### 函数适配器

函数适配器通过函数进行变换。

函数适配器提供了执行任意变换的能力。

### 例子

`default` 表示一个基础适配器，其指定了符号和调用的变换方式。

|   | 调用 | 符号 |
| - | - | - |
| `form` | 形式 | 不变 |
| `form.` | 形式 | 字面量 |
| `form@` | 形式 | 引用 |
| `form$` | 形式 | 求值 |
| `eval` | 求值 | 不变 |
| `eval.` | 求值 | 字面量 |
| `eval@` | 求值 | 引用 |
| `eval$` | 求值 | 求值 |

若不指定 `default`，或者指定 `default` 为单元，则表示 `form`

- `eval@`：对任意值应用 `eval@`
- `{}`：对任意值不变换
- `{pair : {} : form. : eval@}`：对配对的第一项应用 `form.`，对配对的第二项应用 `eval@`；对其他任何值不变换
- `{default : eval@}`：对符号应用引用适配器，对调用应用求值适配器，对配对，列表，映射递归应用此适配器
- `{default : eval@, pair : {a : form.} : form@ : {default : eval}}`：若第一项为 `a`，则对第二项应用 `form.`，否则对配对的第一项应用 `form@`，对配对的第二项应用 `{default : eval}`；对符号应用引用适配器，对调用应用求值适配器，对列表，映射递归应用 `eval@` 适配器
- `{default : form, list : [form$, .] : eval.}`：对符号应用不变适配器，对调用应用形式适配器，对列表的第一项应用 `form$`，对第二项应用 `.`，对剩余其他项应用 `eval.`；对配对，映射递归应用 `form` 适配器
- `{map : {a : ., b : eval@} : .}`：对符号应用不变适配器，对调用应用形式适配器，对映射的以 `a` 为键的值应用 `form`，对以 `b` 为键的值应用 `eval@`，对任何其他键的值应用 `form`；对配对，列表递归应用默认适配器（`form`）

## adapter.apply

类型：function

上下文访问：可变

适配器 `adapter@adapter.apply`：`form@`

在上下文中求值 `i`
