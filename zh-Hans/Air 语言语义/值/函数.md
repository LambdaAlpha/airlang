# 函数

函数类型表示一个函数。

## 输入输出模式

函数的输入（输出）模式用于调用（逆向）函数时，预处理输入（输出），将结果作为函数真正的输入（输出）。

输入输出模式分为求值模式和匹配模式。

默认的输入输出模式为积极求值模式。

### 求值模式

- `值模式`：不对输入求值
- 惰性或积极求值模式
  - `. a`：值模式
  - `.true a`：积极求值模式
  - `.false a`：惰性求值模式
  - 复合值递归应用当前模式
  - 其他值
    - `惰性求值模式`：不求值
    - `积极求值模式`：求值

### 匹配模式

匹配模式会根据当前输入（输出）值的类型，应用对应的模式。

#### 符号

求值模式

#### 配对

- 求值模式
- 第一个值的模式 `:` 第二个值的模式

#### 调用

- 求值模式
- 函数的模式 `$` 输入的模式

#### 逆向

- 求值模式
- 函数的模式 `?` 输出的模式

#### 列表

- 求值模式
- 全称模式：对列表所有的元素应用同一个模式
- 部分模式：对列表的部分元素应用指定的模式。对列表元素有一种特殊的模式，称为省略模式，用于列表剩余长度大于模式列表剩余长度时，对一段连续的元素都应用相同的模式，直到列表剩余长度和模式剩余长度相等。

#### 映射

- 求值模式
- 全称模式：对映射中所有的键应用同一个模式，对映射中所有的值应用同一个模式
- 部分模式：对映射中的部分值应用指定的模式。

### 例子

- `.true`：对任意值积极求值
- `{}`：对任意值积极求值
- `{symbol : .}`：不对符号求值；对其他任何值积极求值
- `{pair : ({symbol : .} : {})}`：对配对的第一项应用 `{symbol : .}`，对配对的第二项应用 `{}`；对其他任何值积极求值
- `{list : .}`：不对列表求值；对其他任何值积极求值
- `{list : (all {symbol : .})}`：对列表的每一个元素应用 `{symbol : .}`；对其他任何值积极求值
- `{list : [{symbol : .}, ., ... .true, .]}` 对列表的第一项应用 `{symbol : .}`，对第二项应用 `.`，对第三项至倒数第二项应用 `.true`，对最后一项应用 `.`；对其他任何值积极求值
- `{map : .}`：不对映射求值；对其他任何值积极求值
- `{map : (.false all .true)}`：对映射的每一个元素的键应用 `.false`，对映射的每一个元素的值应用 `.true`；对其他任何值积极求值
- `{map : {a : ., b : .true}}`：对映射的以 `a` 为键的值应用 `.`，对以 `b` 为键的值应用 `.true`，不对映射的其他键求值，对映射的其他键的值积极求值；对其他任何值积极求值
- `{symbol : ., list : (all {symbol : .})}`：不对符号求值；对列表的每一个元素应用 `{symbol : .}`；对其他任何值积极求值

## 上下文访问模式

函数根据其上下文访问模式分为上下文无关函数，上下文不变函数和上下文可变函数。

### 无关模式

上下文无关函数不需要/不能访问上下文。

### 不变模式

上下文不变函数需要/能读取上下文，但不需要/不能改变上下文。

### 可变模式

上下文可变函数既需要/能读取上下文，也需要/能改变上下文。

## 实现方式

### 基础函数

基础函数由语言内置实现或第三方拓展实现。

可以区分基础函数是内置的还是拓展的。

#### 内置

内置基础函数内置于初始上下文中。

每个内置基础函数有一个唯一的标识符，其与初始上下文中此基础函数的键相同。

#### 拓展

每个拓展基础函数有一个唯一的标识符。拓展基础函数的标识符可以和内置的基础函数的标识符一样。

### 组合函数

组合函数是由其他函数组合而成的函数。组合函数有一个函数体，一个内置上下文，一个输入名。当函数为上下文可变/不变函数时，还有一个上下文名。

函数体是一个值。输入名和上下文名是符号。

组合函数被调用时的行为如下

- 其内置上下文被复制一份作为运行上下文

- 函数调用的输入以输入名为键存储至运行上下文中，无不变性

- 当函数为上下文可变/不变函数时，函数调用的上下文以上下文名为键存储至运行上下文中，其不变性为不可赋值/不可变

- 以运行上下文为上下文，以函数体为输入，调用求值函数，并返回其返回值
