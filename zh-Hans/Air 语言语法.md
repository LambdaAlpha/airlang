# Air 语言语法

## 目标

- 语法和语义解耦
- 强表达能力
- 高可读性
- 无歧义
- 规则简单，容易理解
- 线性解析时间
- 具有有限且可控的拓展性

## 设计

- 只表达必要的语义无关的信息，尽可能将计算推迟到语义解释阶段
- 使用调用和逆向表达任何语义
- 提供词组语法，用于自定义语法
- 提供结构化的注解语法

## 关键字

关键字是部分具有特殊语法含义的未加引号的符号

### 硬关键字

硬关键字用于表达部分原子字面量

- `.`
- `true`
- `false`

### 软关键字

除硬关键字外的其他关键字都是软关键字，用于组合无界结构，在其他场景下将退化为其符号自身

- `@`
- `$`
- `:`
- `?`

## 定界符

`(`，`)`，`[`，`]`，`{`，`}`，`,`，`` ` ``

## 自定界结构

自定界结构是原子字面量或者使用定界符定界的结构，包括

- 单元
- 布尔
- 整数
- 浮点数
- 字节
- 符号
- 字符串
- 列表
- 映射
- 词组
- 括号

## 无界结构

无界结构是自定界结构的序列，基于规则组合而成，包括

- 注解
- 配对
- 调用（`f $ a`，`f a`，`a f b`）
- 逆向

无界结构的序列中的元素之间必须以空白符隔开

### 规范

- 单个参数：使用形如 `a b` 的前缀形式，其中 `a` 是软关键字
- 两个参数：使用形如 `a b c` 的中缀形式，其中 `b` 是软关键字
- 三个或以上参数：使用形如 `a [b, c, d, ...]`，``a `b c d ...` `` 或 `a {b : c, d : e, f : g, ...}` 的前缀形式，其中 `a` 是软关键字

### 结合规则

中缀形式和前缀形式嵌套使用时，必须使用 `()` 消除歧义。例如：

```air
(a b) : c
a : (b c)
(a b) ? c
a ? (b c)
(a b) + c
a + (b c)
a (b : c)
a (b ? c)
a (b + c)
(a : b) c
(a ? b) c
(a + b) c
```

因此只有中缀形式需要考虑结合规则，而中缀形式只有一条结合规则：右结合。

## 简写形式

- `a $ b` 可以简写为 `a b`
- `b $ a : c` 可以简写为 `a b c`
- 形如 `a b c` 的中缀形式，其中 `b` 是软关键字。若 `a` 和 `c` 相同，则可以简写为 `b c` 形式。例如：
  - `@ a` === `a @ a`
  - `: a` === `a : a`
  - `$ a` === `a $ a`
  - `? a` === `a ? a`
  - `{: a}` === `{a : a}`
- 在映射中，如果键值对中的值为 `'`，则可以简写，比如 `{a : ', b : c}` 可以简写为 `{a, b : c}`

## 兼容性

- 包含定界符的符号，必须使用加引号的形式
- 保留以原子字面量的特征前缀开头的所有符号，用于未来拓展这些原子字面量的语法
- 可以使用加引号的形式避免和关键词的冲突

## 空白符

`[ \t\r\n]+`

空白符用于分隔词汇。

## 括号

`(a)`

‌`a‌` 为任意字面量。

`(a)` 被解析为 `a`。

括号是一种定界符，括号内外的语法解析彼此独立，括号外部的语法解析不依赖括号内部的语法特征。

括号用于增强可读性和辅助语法解析。

示例：

```air
(a) === a
(a b) === a b
(a @ b) === b
(a b) : c === (a b) : c
a (b : c) === a (b : c)
a b c === b (a : c)
a b [] === b (a : [])
(a b) [] === (a b) []
a (b c d) e === (c (b : d))(a : e)
a [] b === [] (a : b)
```

## 注解

`note @ value`

`note` 和 `value` 为任意字面量。`note @ value` 被解析为 `value`。

注解用于表达额外的信息。

示例：

```air
a @ 1
"this is a annotation" @ .
1 @ 2
(a[]) @ .
```

## 词组

`` `a b ... c` ``

`a`，`b`，`...`，`c` 等为自定界结构。`` `a b ... c` `` 被解析为 `a`，`b`，`...`，`c` 等的列表，等价于 `[a, b, ..., c]`。

词组用于自定义语法。

词组中的自定界结构不组合成无界结构，故软关键字退化为其符号自身。

## 字面量

### 原子字面量

[原子字面量语法](./Air%20语言语法/原子字面量语法.md)

### 复合字面量

[复合字面量语法](./Air%20语言语法/复合字面量语法.md)

## 参考

[语法参考](./Air%20语言语法/语法参考.md)
