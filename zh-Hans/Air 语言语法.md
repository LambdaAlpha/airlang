# Air 语言语法

## 目标

- 语法和语义解耦
- 强表达能力
- 高可读性
- 无歧义
- 规则简单，容易理解
- 线性解析时间
- 具有有限且可控的拓展性

## 设计

- 只表达必要的语义无关的信息，尽可能将计算推迟到语义解释阶段
- 使用调用和询问表达任何语义
- 提供上下文语法，根据上下文切换解析规则
- 提供不结合语法，用于自定义语法
- 提供结构化的注释语法

## 关键字

关键字是部分具有特殊语法含义的未加引号的符号

### 硬关键字

硬关键字用于表达部分原子字面量

- `.`
- `true`
- `false`

### 软关键字

除硬关键字外的其他关键字都是软关键字，用于组合无界结构，在其他场景下将退化为其符号自身

- `;`
- `!`
- `:`
- `?`

## 定界符

` `，`(`，`)`，`[`，`]`，`{`，`}`，`,`，`'`，`"`

## 原子结构

原子结构是不可进一步拆分的结构。形如

- 未加引号的符号
- `'a'`，`"a"`
- `(a)`，`[a]`，`{a}`
- `a'b'`，`a"b"`，`a(b)`，`a[b]`，`a{b}`，其中 `a` 是未加引号的符号

## 无界结构

无界结构是不可拆分的子结构的序列，基于规则组合而成，包括

- 注释
- 配对
- 调用（`f ! a`，`f a`，`a f b`）
- 询问

无界结构的序列中的元素之间必须以空白符隔开

### 规范

- 单个参数：使用形如 `a b` 的前缀形式，其中 `a` 是软关键字
- 两个参数：使用形如 `a b c` 的中缀形式，其中 `b` 是软关键字
- 三个或以上参数：使用形如 `a [b, c, d, ...]`，``a `b c d ...` `` 或 `a {b : c, d : e, f : g, ...}` 的前缀形式，其中 `a` 是软关键字

### 结合规则

词汇根据语法上下文的规则结合。

## 简写形式

- `a f b` 可以简写为 `a b`，其中`f` 为上下文中的隐式构造器
- `b f a : c` 可以简写为 `a b c`，其中`f` 为上下文中的隐式构造器
- 形如 `a b c` 的中缀形式，若 `a` 和 `c` 相同，则可以简写为 `a b :` 形式。例如：
  - `a ; :` === `a ; a`
  - `a : :` === `a : a`
  - `a ! :` === `a ! a`
  - `a ? :` === `a ? a`
  - `(a b c) d :` === `(a b c) d (a b c)`
  - `{a : :}` === `{a : a}`
- 在映射中，如果键值对中的值为单元，则可以简写，比如 `{a : ., b : c}` 可以简写为 `{a, b : c}`

## 兼容性

- 包含定界符的符号，必须使用加引号的形式
- 保留以 `0-9` 为前缀的所有符号，用于未来拓展数的语法
- 可以使用加引号的形式避免和关键词的冲突

## 空白符

`[ \t\r\n]+`

空白符用于分隔词汇。

## 作用域

作用域是一种定界符，作用域内外的语法解析彼此独立，作用域外部的语法解析不依赖作用域内部的语法特征。

作用域可以提供语法上下文。作用域继承外部作用域的上下文，并修改部分配置。

### 空作用域

`(a)`

`(a)` 被解析为 `a`。

空作用域继承外部作用域的上下文，不修改任何配置。

空作用域用于增强可读性和辅助语法解析。

示例：

```air
(a) === a
(a b) === a b
(a ; b) === b
(a b) : c === (a b) : c
a (b : c) === a (b : c)
a b c === b (a : c)
a b [] === b (a : [])
(a b) [] === (a b) []
a (b c d) e === (c (b : d)) (a : e)
a [] b === [] (a : b)
```

### 左结合作用域

`<(a)`

作用域内左结合。

示例：

```air
<(a b c d e) === (a b c) d e
<(a) === a
<(a b) === a b
<(a b c) === a b c
<(a : b) === a : b
```

### 右结合作用域

`>(a)`

作用域内右结合。

示例：

```air
>(a b c d e) === a b (c d e)
>(a) === a
>(a b) === a b
>(a b c) === a b c
>(a : b) === a : b
```

### 不结合作用域

`^(a b ... c)`

`a`，`b`，`...`，`c` 等为原子结构。

作用域内不结合。

- `^(a)` 等价于 `a`
- `^(a b ... c)` 等价于 `^ ; [a, b, ..., c]`。

不结合作用域用于自定义语法。

不结合作用域中的原子结构不组合成无界结构，故软关键字退化为其符号自身。

### 调用作用域

`!(a)`

作用域内以调用为隐式构造器。

示例：

```air
!(a b) === a ! b
!(a b c) === b ! a : c
```

### 询问作用域

`?(a)`

作用域内以询问为隐式构造器。

示例：

```air
?(a b) === a ? b
?(a b c) === b ? a : c
```

### 单元作用域

`.(a)`

作用域内构造器参数个数为 1。

示例：

```air
.(a b) === a ! b
.(a b c) === a ! (b ! c)
.(a b c d) === a ! (b ! (c ! d))
```

### 配对作用域

`:(a)`

作用域内部构造器参数个数为 2。

示例：

```air
:(a b) === a ! b
:(a b c) === b ! (a : c)
```

## 字面量

### 原子字面量

原子字面量内部使用大写字母或非字母符号分段。

[原子字面量语法](./Air%20语言语法/原子字面量语法.md)

### 复合字面量

[复合字面量语法](./Air%20语言语法/复合字面量语法.md)

## 参考

[语法参考](./Air%20语言语法/语法参考.md)
